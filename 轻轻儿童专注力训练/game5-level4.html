<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬4å…³ - å½¢çŠ¶æ‰¾ä¸€æ‰¾</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .shapes-grid {display:grid;grid-template-columns:repeat(4,1fr);gap:13px;max-width:380px;margin:17px auto 0;}
        .shape-card {background:#fff;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:42px;cursor:pointer;border:4px solid transparent;min-height:70px;transition:box-shadow .2s,border-color .2s,transform .14s;}
        .shape-card.correct {border-color:#a29bfe;box-shadow:0 0 10px #a29bfeaa;animation:bounce .6s;background:#f3f0ff;}
        .shape-card.wrong {border-color:#e17055;animation:shake .5s;background:#ffe7e5;}
        .shape-card.found {pointer-events:none;opacity:.5;}
        .shape-status-bar {margin:14px auto 8px;font-size:18px;color:#555;text-align:center;}
    </style>
</head>
<body class="game-page">
    <div class="container">
        <div class="game-header"><div class="back-btn" onclick="goHome()">â¬…ï¸</div>
            <div class="game-info"><div class="level-title">å½¢çŠ¶æ‰¾ä¸€æ‰¾ â€¢ ç¬¬ 4 å…³</div><div class="timer" id="timer">â±ï¸ 0ç§’</div></div>
        </div>
        <div class="game-area">
            <div class="game-instruction">
                æ‰¾å‡ºæ‰€æœ‰ <span style="color:#a29bfe;font-weight:bold">ç´«è‰²/ç²‰è‰²è±å½¢</span> <span style="font-size:28px;">ğŸ”·</span>
            </div>
            <div class="shape-status-bar">
                å·²æ‰¾åˆ° <b id="foundCount">0</b> / <b id="totalCount">0</b>
            </div>
            <div class="shapes-grid" id="shapesGrid"></div>
        </div>
    </div>
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ å¤ªæ£’äº†!</h2>
            <div class="star-rating" id="starRating">â­â­â­</div>
            <p id="endText">ç´«/ç²‰è‰²è±å½¢å…¨æ‰¾é½å•¦ï¼</p>
            <p id="timeUsed">ç”¨æ—¶: 0ç§’</p>
            <p id="resultTips" style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;font-size:14px;line-height:1.6;color:#856404;"></p>
            <div><button class="btn btn-secondary" onclick="retryLevel()">ğŸ”„ å†ç©ä¸€æ¬¡</button><button class="btn btn-primary" onclick="nextLevel('game5',4)">â¡ï¸ ä¸‹ä¸€å…³</button></div>
        </div>
    </div>
    <script src="js/main.js"></script>
    <script>
    const SHAPES = [
      {icon:'ğŸ”·', color:'#a29bfe', type:'purple-diamond', isTarget:true },
      {icon:'ğŸ”·', color:'#a29bfe', type:'purple-diamond', isTarget:true },
      {icon:'ğŸ”¸', color:'#fd79a8', type:'pink-diamond', isTarget:true },
      {icon:'ğŸ”¸', color:'#fd79a8', type:'pink-diamond', isTarget:true },
      {icon:'ğŸŸ¦', color:'#0984e3', type:'blue-square', isTarget:false },
      {icon:'ğŸ”º', color:'#e17055', type:'red-triangle', isTarget:false},
      {icon:'ğŸŸ¢', color:'#00b894', type:'green-circle', isTarget:false},
      {icon:'ğŸŸ£', color:'#a29bfe', type:'purple-circle', isTarget:false},
      {icon:'ğŸ”¶', color:'#febd46', type:'orange-diamond', isTarget:false},
      {icon:'â¬›', color:'#636e72', type:'black-square', isTarget:false},
      {icon:'ğŸ”·', color:'#a29bfe', type:'purple-diamond', isTarget:true }
    ];
    let targets, found, canClick=true;
    let timerInterval, startTime, errorCount=0;
    function renderShapes() {
      let grid = document.getElementById('shapesGrid');
      let shuffled = [...SHAPES].sort(()=>Math.random()-0.5);
      grid.innerHTML = '';
      found = 0;
      targets = shuffled.filter(s=>s.isTarget).length;
      document.getElementById('foundCount').textContent = 0;
      document.getElementById('totalCount').textContent = targets;
      shuffled.forEach((item,idx)=>{
        let div=document.createElement('div');
        div.className='shape-card';
        div.innerHTML=`<span style='color:${item.color};font-size:40px'>${item.icon}</span>`;
        div.title=item.type;
        div.onclick=()=>selectShape(div,item.isTarget);
        grid.appendChild(div);
      });
    }
    function selectShape(card,isTarget){
      if(!canClick||card.classList.contains('found'))return;
      if(isTarget){
        playSound('correct');card.classList.add('correct','found');
        found++;
        document.getElementById('foundCount').textContent=found;
        if(found===targets) setTimeout(()=>passGame(), 400);
      }else{
        playSound('wrong');card.classList.add('wrong');errorCount++;
        setTimeout(()=>card.classList.remove('wrong'),650);
      }
    }
    function startTimer(){startTime=Date.now();timerInterval=setInterval(()=>{let t=Math.floor((Date.now()-startTime)/1000);document.getElementById('timer').textContent=`â±ï¸ ${t}ç§’`;},1000);}
    function passGame(){
      clearInterval(timerInterval);
      let used=Math.floor((Date.now()-startTime)/1000),stars=3;
      if(used>35||errorCount>=4)stars=1;else if(used>20||errorCount>=2)stars=2;
      updateLevelProgress('game5',4,stars);
      playSound('win');
      document.getElementById('starRating').textContent = 'â­'.repeat(stars)+'â˜†'.repeat(3-stars);
      document.getElementById('timeUsed').textContent=`ç”¨æ—¶: ${used}ç§’`;
      showModal('resultModal');
    }
    window.onload=function(){renderShapes();startTimer();errorCount=0;}
    </script>
</body>
</html>
