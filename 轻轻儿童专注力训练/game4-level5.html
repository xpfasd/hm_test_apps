<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬5å…³ - æ•°æ•°é¡¹ç›®</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="game-page">
    <div class="container">
        <div class="game-header">
            <div class="back-btn" onclick="goHome()">â¬…ï¸</div>
            <div class="game-info">
                <div class="level-title">æ•°æ•°é¡¹ç›® â€¢ ç¬¬ 5 å…³ ğŸ‘‘</div>
                <div class="timer" id="timer">â±ï¸ 90ç§’</div>
            </div>
        </div>
        <div class="game-area">
            <div class="game-instruction">ğŸ† <strong>æŒ‘æˆ˜å…³å¡ï¼</strong><br>æ•°ä¸€æ•°æœ‰å‡ åª<strong id="targetAnimal">ğŸ¶</strong>ï¼Ÿ<br><small style="color: #ff6b6b;">âš ï¸ åŠ¨ç‰©ä¼šé€æ¸æ¶ˆå¤±ï¼</small></div>
            <div class="animals-grid" id="animalsGrid" style="grid-template-columns: repeat(5, 1fr); gap: 8px;"></div>
            <div style="margin-top: 20px;">
                <div style="font-size: 18px; color: #666; margin-bottom: 12px;">é€‰æ‹©ç­”æ¡ˆï¼š</div>
                <div id="answersGrid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 360px; margin: 0 auto;"></div>
            </div>
        </div>
    </div>
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ æ­å–œé€šå…³!</h2>
            <div class="star-rating" id="starRating">â­â­â­</div>
            <p>ä½ æ˜¯æ•°æ•°å¤§å¸ˆï¼ğŸ†</p>
            <p id="timeUsed">ç”¨æ—¶: 0ç§’</p>
            <p id="resultTips" style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;font-size:14px;line-height:1.6;color:#856404;"></p>
            <div>
                <button class="btn btn-secondary" onclick="retryLevel()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <button class="btn btn-primary" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
            </div>
        </div>
    </div>
    <div class="modal" id="failModal">
        <div class="modal-content">
            <h2>â° æ—¶é—´åˆ°!</h2>
            <p>æŒ‘æˆ˜å…³å¡å¾ˆéš¾ï¼Œä½†ä½ å·²ç»å¾ˆæ£’äº†ï¼</p>
            <div>
                <button class="btn btn-secondary" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
                <button class="btn btn-primary" onclick="retryLevel()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>
    <script src="js/main.js"></script>
    <script>
        const ANIMALS = ['ğŸ¶', 'ğŸ±', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ·', 'ğŸ®', 'ğŸ¸'];
        const GAME_CONFIG = { level: 5, game: 'game4', maxCount: 15, timeLimit: 90 };
        let startTime, timerInterval, fadeInterval, correctAnswer, timeRemaining = 90, gameCompleted = false;

        function initGame() {
            startTime = Date.now();
            gameCompleted = false;
            timeRemaining = GAME_CONFIG.timeLimit;
            const targetAnimal = ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
            correctAnswer = Math.floor(Math.random() * GAME_CONFIG.maxCount) + 1;
            
            document.getElementById('targetAnimal').textContent = targetAnimal;
            
            const animals = [];
            for (let i = 0; i < correctAnswer; i++) animals.push(targetAnimal);
            const otherCount = 20 - correctAnswer;
            for (let i = 0; i < otherCount; i++) {
                const other = ANIMALS.filter(a => a !== targetAnimal);
                animals.push(other[Math.floor(Math.random() * other.length)]);
            }
            animals.sort(() => Math.random() - 0.5);
            
            const grid = document.getElementById('animalsGrid');
            grid.innerHTML = '';
            animals.forEach(animal => {
                const card = document.createElement('div');
                card.className = 'animal-card';
                card.style.fontSize = '32px';
                card.textContent = animal;
                card.style.cursor = 'default';
                card.style.transition = 'opacity 0.5s';
                card.onclick = null;
                grid.appendChild(card);
            });
            
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';
            for (let i = 1; i <= 15; i++) {
                const btn = document.createElement('div');
                btn.className = 'animal-card';
                btn.style.background = 'linear-gradient(135deg, #a29bfe, #6c5ce7)';
                btn.style.fontSize = '22px';
                btn.style.cursor = 'pointer';
                btn.textContent = i;
                btn.onclick = () => checkAnswer(i, btn);
                answersGrid.appendChild(btn);
            }
            
            startTimer();
            startFading();
        }

        function startFading() {
            setTimeout(() => {
                const cards = document.querySelectorAll('.animals-grid .animal-card');
                fadeInterval = setInterval(() => {
                    if (gameCompleted) return;
                    const visibleCards = Array.from(cards).filter(c => c.style.opacity !== '0');
                    if (visibleCards.length > 0) {
                        const randomCard = visibleCards[Math.floor(Math.random() * visibleCards.length)];
                        randomCard.style.opacity = '0';
                    }
                }, 2000);
            }, 5000);
        }

        function checkAnswer(answer, btn) {
            if (gameCompleted) return;
            if (answer === correctAnswer) {
                playSound('correct');
                btn.classList.add('correct');
                setTimeout(() => completeGame(), 500);
            } else {
                playSound('wrong');
                btn.classList.add('wrong');
                setTimeout(() => btn.classList.remove('wrong'), 1000);
            }
        }

        function startTimer() {
            const timerEl = document.getElementById('timer');
            timerInterval = setInterval(() => {
                timeRemaining--;
                timerEl.textContent = `â±ï¸ ${timeRemaining}ç§’`;
                if (timeRemaining <= 20) timerEl.style.color = '#d63031';
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    clearInterval(fadeInterval);
                    if (!gameCompleted) {
                        gameCompleted = true;
                        showModal('failModal');
                    }
                }
            }, 1000);
        }

        function completeGame() {
            if (gameCompleted) return;
            gameCompleted = true;
            clearInterval(timerInterval);
            clearInterval(fadeInterval);
            const timeUsed = GAME_CONFIG.timeLimit - timeRemaining;
            let stars = timeUsed <= 45 ? 3 : timeUsed <= 70 ? 2 : 1;
            updateLevelProgress(GAME_CONFIG.game, GAME_CONFIG.level, stars);
            playSound('win');
            document.getElementById('starRating').textContent = 'â­'.repeat(stars) + 'â˜†'.repeat(3 - stars);
            document.getElementById('timeUsed').textContent = `ç”¨æ—¶: ${timeUsed}ç§’`;
            setTimeout(() => showModal('resultModal'), 800);
        }

        window.onload = initGame;
    </script>
</body>
</html>

