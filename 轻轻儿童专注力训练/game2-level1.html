<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬1å…³ - è®°å¿†ç¿»ç‰Œ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            position: relative;
            transform-style: preserve-3d;
        }
        
        .memory-card.flipped {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            transform: rotateY(180deg);
        }
        
        .memory-card.matched {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            animation: bounce 0.6s;
            cursor: default;
        }
        
        .card-back, .card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            border-radius: 20px;
        }
        
        .card-front {
            transform: rotateY(180deg);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 18px;
            color: #666;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b6b;
        }
    </style>
</head>
<body class="game-page">
    <div class="container">
        <div class="game-header">
            <div class="back-btn" onclick="goHome()">â¬…ï¸</div>
            <div class="game-info">
                <div class="level-title">è®°å¿†ç¿»ç‰Œ â€¢ ç¬¬ 1 å…³</div>
                <div class="timer" id="timer">â±ï¸ 0ç§’</div>
            </div>
        </div>

        <div class="game-area">
            <div class="game-instruction">
                ç¿»å¼€å¡ç‰‡ï¼Œæ‰¾å‡º<br>ç›¸åŒçš„å°åŠ¨ç‰©é…å¯¹ï¼
            </div>
            
            <div class="memory-grid" id="memoryGrid">
                <!-- å¡ç‰‡å°†ç”±JavaScriptç”Ÿæˆ -->
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="pairsFound">0</div>
                    <div>æ‰¾åˆ°é…å¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="moves">0</div>
                    <div>ç¿»ç‰Œæ¬¡æ•°</div>
                </div>
            </div>
        </div>
    </div>

    <!-- å®Œæˆå¼¹çª— -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ å¤ªæ£’äº†!</h2>
            <div class="star-rating" id="starRating">â­â­â­</div>
            <p>ä½ æ‰¾åˆ°äº†æ‰€æœ‰é…å¯¹ï¼</p>
            <p id="timeUsed">ç”¨æ—¶: 0ç§’</p>
            <p id="movesUsed">ç¿»ç‰Œ: 0æ¬¡</p>
            <p id="resultTips" style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;font-size:14px;line-height:1.6;color:#856404;"></p>
            <div>
                <button class="btn btn-secondary" onclick="retryLevel()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <button class="btn btn-primary" onclick="nextLevel('game2', 1)">â¡ï¸ ä¸‹ä¸€å…³</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        const GAME_CONFIG = {
            level: 1,
            game: 'game2',
            pairs: 2, // 2å¯¹å¡ç‰‡
            animals: ['ğŸ¶', 'ğŸ±'],
        };

        let startTime;
        let timerInterval;
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let canFlip = true;
        let gameCompleted = false;
        let cards = [];

        function initGame() {
            startTime = Date.now();
            gameCompleted = false;
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            canFlip = true;
            
            // ç”Ÿæˆå¡ç‰‡æ•°ç»„ï¼ˆæ¯ä¸ªåŠ¨ç‰©2å¼ ï¼‰
            cards = [];
            GAME_CONFIG.animals.forEach(animal => {
                cards.push({ animal, id: Math.random() });
                cards.push({ animal, id: Math.random() });
            });
            
            // éšæœºæ‰“ä¹±
            cards.sort(() => Math.random() - 0.5);
            
            generateCards();
            startTimer();
            updateStats();
        }

        function generateCards() {
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            
            cards.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'memory-card';
                cardDiv.dataset.index = index;
                cardDiv.dataset.animal = card.animal;
                
                cardDiv.innerHTML = `
                    <div class="card-back">â“</div>
                    <div class="card-front">${card.animal}</div>
                `;
                
                cardDiv.onclick = () => flipCard(index, cardDiv);
                grid.appendChild(cardDiv);
            });
        }

        function flipCard(index, cardElement) {
            if (!canFlip || gameCompleted) return;
            if (cardElement.classList.contains('flipped') || cardElement.classList.contains('matched')) return;
            if (flippedCards.length >= 2) return;
            
            // ç¿»å¼€å¡ç‰‡
            playSound('click');
            cardElement.classList.add('flipped');
            flippedCards.push({ index, element: cardElement, animal: cards[index].animal });
            
            if (flippedCards.length === 2) {
                moves++;
                updateStats();
                checkMatch();
            }
        }

        function checkMatch() {
            canFlip = false;
            const [card1, card2] = flippedCards;
            
            if (card1.animal === card2.animal) {
                // é…å¯¹æˆåŠŸ
                playSound('correct');
                setTimeout(() => {
                    card1.element.classList.add('matched');
                    card2.element.classList.add('matched');
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    
                    matchedPairs++;
                    updateStats();
                    flippedCards = [];
                    canFlip = true;
                    
                    if (matchedPairs >= GAME_CONFIG.pairs) {
                        setTimeout(() => completeGame(), 500);
                    }
                }, 600);
            } else {
                // é…å¯¹å¤±è´¥
                playSound('wrong');
                setTimeout(() => {
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    flippedCards = [];
                    canFlip = true;
                }, 1000);
            }
        }

        function updateStats() {
            document.getElementById('pairsFound').textContent = matchedPairs;
            document.getElementById('moves').textContent = moves;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timer').textContent = `â±ï¸ ${elapsed}ç§’`;
            }, 1000);
        }

        function completeGame() {
            if (gameCompleted) return;
            gameCompleted = true;
            
            clearInterval(timerInterval);
            const timeUsed = Math.floor((Date.now() - startTime) / 1000);
            
            // è®¡ç®—æ˜Ÿçº§ï¼ˆåŸºäºç¿»ç‰Œæ¬¡æ•°å’Œæ—¶é—´ï¼‰
            let stars = 3;
            const minMoves = GAME_CONFIG.pairs * 2; // æœ€å°‘ç¿»ç‰Œæ¬¡æ•°
            if (moves > minMoves * 3 || timeUsed > 60) stars = 1;
            else if (moves > minMoves * 2 || timeUsed > 30) stars = 2;
            
            updateLevelProgress(GAME_CONFIG.game, GAME_CONFIG.level, stars);
            
            playSound('win');
            document.getElementById('starRating').textContent = 'â­'.repeat(stars) + 'â˜†'.repeat(3 - stars);
            document.getElementById('timeUsed').textContent = `ç”¨æ—¶: ${timeUsed}ç§’`;
            document.getElementById('movesUsed').textContent = `ç¿»ç‰Œ: ${moves}æ¬¡`;
            
            setTimeout(() => {
                showModal('resultModal');
            }, 800);
        }

        window.onload = initGame;
    </script>
</body>
</html>
