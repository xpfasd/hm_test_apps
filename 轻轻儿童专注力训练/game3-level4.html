<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬4å…³ - é¢œè‰²é…å¯¹</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .color-target {
            background: white;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .target-label {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .color-sample {
            width: 70px;
            height: 70px;
            margin: 8px auto;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }
        
        .color-animals-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 360px;
        }
        
        .color-animal-card {
            aspect-ratio: 1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 38px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            border: 4px solid transparent;
        }
        
        .color-animal-card:active {
            transform: scale(0.95);
        }
        
        .color-animal-card.selected {
            border-color: #00b894;
            transform: scale(1.05);
            animation: bounce 0.6s;
        }
        
        .color-animal-card.wrong {
            border-color: #d63031;
            animation: shake 0.5s;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 16px;
            color: #666;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .time-warning {
            animation: pulse 0.5s infinite;
        }
    </style>
</head>
<body class="game-page">
    <div class="container">
        <div class="game-header">
            <div class="back-btn" onclick="goHome()">â¬…ï¸</div>
            <div class="game-info">
                <div class="level-title">é¢œè‰²é…å¯¹ â€¢ ç¬¬ 4 å…³</div>
                <div class="timer" id="timer">â±ï¸ 90ç§’</div>
            </div>
        </div>

        <div class="game-area">
            <div class="game-instruction">
                æ‰¾å‡ºæ‰€æœ‰<strong id="targetColorName">çº¢è‰²</strong>çš„å°åŠ¨ç‰©ï¼<br>
                <small style="color: #ff6b6b;">âš ï¸ é™æ—¶90ç§’ï¼</small>
            </div>
            
            <div class="color-target">
                <div class="target-label">ç›®æ ‡é¢œè‰²</div>
                <div class="color-sample" id="colorSample"></div>
            </div>
            
            <div class="color-animals-grid" id="animalsGrid">
                <!-- åŠ¨ç‰©å¡ç‰‡å°†ç”±JavaScriptç”Ÿæˆ -->
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="foundCount">0</div>
                    <div>å·²æ‰¾åˆ°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="errorCount">0</div>
                    <div>é”™è¯¯æ¬¡æ•°</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ å¤ªæ£’äº†!</h2>
            <div class="star-rating" id="starRating">â­â­â­</div>
            <p>åœ¨æ—¶é—´å‹åŠ›ä¸‹ä¾ç„¶è¡¨ç°å‡ºè‰²ï¼</p>
            <p id="timeUsed">ç”¨æ—¶: 0ç§’</p>
            <p id="resultTips" style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;font-size:14px;line-height:1.6;color:#856404;"></p>
            <div>
                <button class="btn btn-secondary" onclick="retryLevel()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <button class="btn btn-primary" onclick="nextLevel('game3', 4)">â¡ï¸ ä¸‹ä¸€å…³</button>
            </div>
        </div>
    </div>

    <div class="modal" id="failModal">
        <div class="modal-content">
            <h2>â° æ—¶é—´åˆ°!</h2>
            <p>å†è¯•ä¸€æ¬¡ï¼Œä½ å¯ä»¥åšåˆ°çš„ï¼</p>
            <div>
                <button class="btn btn-secondary" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
                <button class="btn btn-primary" onclick="retryLevel()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        const COLORS = {
            red: { name: 'çº¢è‰²', bg: 'linear-gradient(135deg, #ff6b6b, #ee5a6f)', value: '#ff6b6b' },
            blue: { name: 'è“è‰²', bg: 'linear-gradient(135deg, #4ecdc4, #44a08d)', value: '#4ecdc4' },
            yellow: { name: 'é»„è‰²', bg: 'linear-gradient(135deg, #ffeaa7, #fdcb6e)', value: '#ffeaa7' },
            purple: { name: 'ç´«è‰²', bg: 'linear-gradient(135deg, #a29bfe, #6c5ce7)', value: '#a29bfe' },
            green: { name: 'ç»¿è‰²', bg: 'linear-gradient(135deg, #55efc4, #00b894)', value: '#55efc4' },
        };

        const GAME_CONFIG = {
            level: 4,
            game: 'game3',
            targetColor: 'red',
            timeLimit: 90,
            animals: [
                { emoji: 'ğŸ¶', color: 'red' },
                { emoji: 'ğŸ±', color: 'red' },
                { emoji: 'ğŸ°', color: 'red' },
                { emoji: 'ğŸ¦Š', color: 'blue' },
                { emoji: 'ğŸ»', color: 'blue' },
                { emoji: 'ğŸ¼', color: 'blue' },
                { emoji: 'ğŸ¨', color: 'yellow' },
                { emoji: 'ğŸ¯', color: 'yellow' },
                { emoji: 'ğŸ¦', color: 'yellow' },
                { emoji: 'ğŸ·', color: 'purple' },
                { emoji: 'ğŸ®', color: 'purple' },
                { emoji: 'ğŸ¸', color: 'green' },
                { emoji: 'ğŸµ', color: 'green' },
                { emoji: 'ğŸ”', color: 'green' },
                { emoji: 'ğŸº', color: 'purple' },
            ],
        };

        let startTime, timerInterval;
        let foundCount = 0, errorCount = 0;
        let gameCompleted = false;
        let selectedCards = new Set();
        let timeRemaining = GAME_CONFIG.timeLimit;

        function initGame() {
            startTime = Date.now();
            gameCompleted = false;
            foundCount = 0;
            errorCount = 0;
            selectedCards = new Set();
            timeRemaining = GAME_CONFIG.timeLimit;
            
            const colorKeys = Object.keys(COLORS);
            GAME_CONFIG.targetColor = colorKeys[Math.floor(Math.random() * colorKeys.length)];
            
            const targetColor = COLORS[GAME_CONFIG.targetColor];
            document.getElementById('targetColorName').textContent = targetColor.name;
            document.getElementById('colorSample').style.background = targetColor.bg;
            
            GAME_CONFIG.animals.sort(() => Math.random() - 0.5);
            
            generateAnimals();
            startTimer();
            updateStats();
        }

        function generateAnimals() {
            const grid = document.getElementById('animalsGrid');
            grid.innerHTML = '';
            
            GAME_CONFIG.animals.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = 'color-animal-card';
                card.style.background = COLORS[animal.color].bg;
                card.textContent = animal.emoji;
                card.dataset.index = index;
                card.dataset.color = animal.color;
                
                card.onclick = () => selectAnimal(index, card, animal.color);
                grid.appendChild(card);
            });
        }

        function selectAnimal(index, cardElement, color) {
            if (gameCompleted) return;
            if (selectedCards.has(index)) return;
            
            selectedCards.add(index);
            
            if (color === GAME_CONFIG.targetColor) {
                playSound('correct');
                cardElement.classList.add('selected');
                cardElement.onclick = null;
                foundCount++;
                updateStats();
                
                const totalTarget = GAME_CONFIG.animals.filter(a => a.color === GAME_CONFIG.targetColor).length;
                if (foundCount >= totalTarget) {
                    setTimeout(() => completeGame(), 500);
                }
            } else {
                playSound('wrong');
                cardElement.classList.add('wrong');
                errorCount++;
                updateStats();
                
                setTimeout(() => {
                    cardElement.classList.remove('wrong');
                    selectedCards.delete(index);
                }, 1000);
            }
        }

        function updateStats() {
            document.getElementById('foundCount').textContent = foundCount;
            document.getElementById('errorCount').textContent = errorCount;
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            timerInterval = setInterval(() => {
                timeRemaining--;
                timerElement.textContent = `â±ï¸ ${timeRemaining}ç§’`;
                
                if (timeRemaining <= 20 && timeRemaining > 0) {
                    timerElement.classList.add('time-warning');
                    timerElement.style.color = '#d63031';
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    if (!gameCompleted) {
                        gameCompleted = true;
                        playSound('wrong');
                        setTimeout(() => {
                            showModal('failModal');
                        }, 500);
                    }
                }
            }, 1000);
        }

        function completeGame() {
            if (gameCompleted) return;
            gameCompleted = true;
            
            clearInterval(timerInterval);
            const timeUsed = GAME_CONFIG.timeLimit - timeRemaining;
            
            let stars = 3;
            if (errorCount >= 4 || timeUsed > 75) stars = 1;
            else if (errorCount >= 2 || timeUsed > 60) stars = 2;
            
            updateLevelProgress(GAME_CONFIG.game, GAME_CONFIG.level, stars);
            
            playSound('win');
            document.getElementById('starRating').textContent = 'â­'.repeat(stars) + 'â˜†'.repeat(3 - stars);
            document.getElementById('timeUsed').textContent = `ç”¨æ—¶: ${timeUsed}ç§’`;
            
            setTimeout(() => {
                showModal('resultModal');
            }, 800);
        }

        window.onload = initGame;
    </script>
</body>
</html>

