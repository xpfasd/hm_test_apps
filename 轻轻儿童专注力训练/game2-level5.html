<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬5å…³ - è®°å¿†ç¿»ç‰Œ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            position: relative;
            transform-style: preserve-3d;
        }
        
        .memory-card.flipped {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            transform: rotateY(180deg);
        }
        
        .memory-card.matched {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            animation: bounce 0.6s;
            cursor: default;
        }
        
        .card-back, .card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            border-radius: 15px;
        }
        
        .card-front {
            transform: rotateY(180deg);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 16px;
            color: #666;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .time-warning {
            animation: pulse 0.5s infinite;
        }
    </style>
</head>
<body class="game-page">
    <div class="container">
        <div class="game-header">
            <div class="back-btn" onclick="goHome()">â¬…ï¸</div>
            <div class="game-info">
                <div class="level-title">è®°å¿†ç¿»ç‰Œ â€¢ ç¬¬ 5 å…³ ğŸ‘‘</div>
                <div class="timer" id="timer">â±ï¸ 120ç§’</div>
            </div>
        </div>

        <div class="game-area">
            <div class="game-instruction">
                ğŸ† <strong>æŒ‘æˆ˜å…³å¡ï¼</strong><br>
                æ‰¾å‡º<strong>6å¯¹</strong>é…å¯¹ï¼<br>
                <small style="color: #ff6b6b;">âš ï¸ é™æ—¶120ç§’ï¼</small>
            </div>
            
            <div class="memory-grid" id="memoryGrid">
                <!-- å¡ç‰‡å°†ç”±JavaScriptç”Ÿæˆ -->
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="pairsFound">0</div>
                    <div>æ‰¾åˆ°é…å¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="moves">0</div>
                    <div>ç¿»ç‰Œæ¬¡æ•°</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>ğŸ‰ æ­å–œé€šå…³!</h2>
            <div class="star-rating" id="starRating">â­â­â­</div>
            <p>ä½ æ˜¯è®°å¿†åŠ›è¶…äººï¼ğŸ†</p>
            <p id="timeUsed">ç”¨æ—¶: 0ç§’</p>
            <p id="movesUsed">ç¿»ç‰Œ: 0æ¬¡</p>
            <p id="resultTips" style="margin-top:15px;padding:10px;background:#fff3cd;border-radius:8px;font-size:14px;line-height:1.6;color:#856404;"></p>
            <div>
                <button class="btn btn-secondary" onclick="retryLevel()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <button class="btn btn-primary" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="failModal">
        <div class="modal-content">
            <h2>â° æ—¶é—´åˆ°!</h2>
            <p>å†è¯•ä¸€æ¬¡ï¼Œç›¸ä¿¡ä½ å¯ä»¥åšåˆ°ï¼</p>
            <div>
                <button class="btn btn-secondary" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
                <button class="btn btn-primary" onclick="retryLevel()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        const GAME_CONFIG = {
            level: 5,
            game: 'game2',
            pairs: 6,
            animals: ['ğŸ¶', 'ğŸ±', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼'],
            timeLimit: 120, // 120ç§’é™æ—¶
        };

        let startTime, timerInterval, flippedCards = [], matchedPairs = 0;
        let moves = 0, canFlip = true, gameCompleted = false, cards = [];
        let timeRemaining = GAME_CONFIG.timeLimit;

        function initGame() {
            startTime = Date.now();
            gameCompleted = false;
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            canFlip = true;
            timeRemaining = GAME_CONFIG.timeLimit;
            
            cards = [];
            GAME_CONFIG.animals.forEach(animal => {
                cards.push({ animal, id: Math.random() });
                cards.push({ animal, id: Math.random() });
            });
            cards.sort(() => Math.random() - 0.5);
            
            generateCards();
            startTimer();
            updateStats();
        }

        function generateCards() {
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            
            cards.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'memory-card';
                cardDiv.dataset.index = index;
                cardDiv.dataset.animal = card.animal;
                
                cardDiv.innerHTML = `
                    <div class="card-back">â“</div>
                    <div class="card-front">${card.animal}</div>
                `;
                
                cardDiv.onclick = () => flipCard(index, cardDiv);
                grid.appendChild(cardDiv);
            });
        }

        function flipCard(index, cardElement) {
            if (!canFlip || gameCompleted) return;
            if (cardElement.classList.contains('flipped') || cardElement.classList.contains('matched')) return;
            if (flippedCards.length >= 2) return;
            
            playSound('click');
            cardElement.classList.add('flipped');
            flippedCards.push({ index, element: cardElement, animal: cards[index].animal });
            
            if (flippedCards.length === 2) {
                moves++;
                updateStats();
                checkMatch();
            }
        }

        function checkMatch() {
            canFlip = false;
            const [card1, card2] = flippedCards;
            
            if (card1.animal === card2.animal) {
                playSound('correct');
                setTimeout(() => {
                    card1.element.classList.add('matched');
                    card2.element.classList.add('matched');
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    
                    matchedPairs++;
                    updateStats();
                    flippedCards = [];
                    canFlip = true;
                    
                    if (matchedPairs >= GAME_CONFIG.pairs) {
                        setTimeout(() => completeGame(), 500);
                    }
                }, 600);
            } else {
                playSound('wrong');
                setTimeout(() => {
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    flippedCards = [];
                    canFlip = true;
                }, 1000);
            }
        }

        function updateStats() {
            document.getElementById('pairsFound').textContent = matchedPairs;
            document.getElementById('moves').textContent = moves;
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            timerInterval = setInterval(() => {
                timeRemaining--;
                timerElement.textContent = `â±ï¸ ${timeRemaining}ç§’`;
                
                // æ—¶é—´ä¸è¶³20ç§’æ—¶è­¦å‘Š
                if (timeRemaining <= 20 && timeRemaining > 0) {
                    timerElement.classList.add('time-warning');
                    timerElement.style.color = '#d63031';
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    if (!gameCompleted) {
                        gameCompleted = true;
                        playSound('wrong');
                        setTimeout(() => {
                            showModal('failModal');
                        }, 500);
                    }
                }
            }, 1000);
        }

        function completeGame() {
            if (gameCompleted) return;
            gameCompleted = true;
            
            clearInterval(timerInterval);
            const timeUsed = GAME_CONFIG.timeLimit - timeRemaining;
            
            let stars = 3;
            const minMoves = GAME_CONFIG.pairs * 2;
            if (moves > minMoves * 3 || timeUsed > 100) stars = 1;
            else if (moves > minMoves * 2.2 || timeUsed > 80) stars = 2;
            
            updateLevelProgress(GAME_CONFIG.game, GAME_CONFIG.level, stars);
            
            playSound('win');
            document.getElementById('starRating').textContent = 'â­'.repeat(stars) + 'â˜†'.repeat(3 - stars);
            document.getElementById('timeUsed').textContent = `ç”¨æ—¶: ${timeUsed}ç§’`;
            document.getElementById('movesUsed').textContent = `ç¿»ç‰Œ: ${moves}æ¬¡`;
            
            // åº†ç¥åŠ¨ç”»
            for (let i = 0; i < 20; i++) {
                setTimeout(() => createScreenConfetti(), i * 100);
            }
            
            setTimeout(() => {
                showModal('resultModal');
            }, 1000);
        }

        function createScreenConfetti() {
            const confetti = document.createElement('div');
            confetti.textContent = ['ğŸ‰', 'ğŸŠ', 'â­', 'ğŸŒŸ', 'âœ¨'][Math.floor(Math.random() * 5)];
            confetti.style.position = 'fixed';
            confetti.style.fontSize = '24px';
            confetti.style.left = Math.random() * window.innerWidth + 'px';
            confetti.style.top = '-50px';
            confetti.style.pointerEvents = 'none';
            confetti.style.zIndex = '9999';
            document.body.appendChild(confetti);
            
            let y = -50;
            const speed = 2 + Math.random() * 3;
            const swing = Math.random() * 100 - 50;
            
            const animate = () => {
                y += speed;
                confetti.style.top = y + 'px';
                confetti.style.transform = `translateX(${Math.sin(y / 30) * swing}px) rotate(${y}deg)`;
                
                if (y < window.innerHeight) {
                    requestAnimationFrame(animate);
                } else {
                    confetti.remove();
                }
            };
            animate();
        }

        window.onload = initGame;
    </script>
</body>
</html>
