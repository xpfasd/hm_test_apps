<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿”å›é¦–é¡µBugä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/features.css">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-info h2 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .test-steps {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .test-steps li {
            margin: 8px 0;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .status-ok {
            background: #4caf50;
            color: white;
        }
        
        .status-error {
            background: #f44336;
            color: white;
        }
        
        .debug-info {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- æµ‹è¯•è¯´æ˜ -->
    <div class="test-info">
        <h2>ğŸ”§ è¿”å›é¦–é¡µBugä¿®å¤æµ‹è¯•</h2>
        <p><strong>é—®é¢˜æè¿°ï¼š</strong>æŒ‘æˆ˜æ¨¡å¼ç»“æŸåï¼Œç‚¹å‡»ã€è¿”å›é¦–é¡µã€‘æŒ‰é’®æ— å“åº”</p>
        <p><strong>ä¿®å¤æ–¹æ¡ˆï¼š</strong></p>
        <ul>
            <li>âœ… ä¿®æ”¹äº† showPage() æ–¹æ³•ï¼Œé‡ç½®æ‰€æœ‰é¡µé¢çš„ display å±æ€§</li>
            <li>âœ… ç‰¹åˆ«å¤„ç†æŒ‘æˆ˜é¡µé¢çš„éšè—é€»è¾‘</li>
            <li>âœ… ç¡®ä¿é¡µé¢åˆ‡æ¢æ—¶åŒæ­¥ active ç±»å’Œ display å±æ€§</li>
        </ul>
        
        <div class="test-steps">
            <h3>æµ‹è¯•æ­¥éª¤ï¼š</h3>
            <ol>
                <li>ç‚¹å‡»ä¸‹æ–¹çš„ã€ä¸€åˆ†é’ŸæŒ‘æˆ˜ã€‘æŒ‰é’®å¯åŠ¨æŒ‘æˆ˜</li>
                <li>åœ¨æŒ‘æˆ˜é¡µé¢ç‚¹å‡»ã€â† é€€å‡ºã€‘æŒ‰é’®ç»“æŸæŒ‘æˆ˜</li>
                <li>åœ¨ç»“æœé¡µé¢ç‚¹å‡»ã€è¿”å›é¦–é¡µã€‘æŒ‰é’®</li>
                <li>éªŒè¯æ˜¯å¦æˆåŠŸè¿”å›åˆ°ä¸»é¡µé¢</li>
            </ol>
        </div>
        
        <p id="status">å½“å‰çŠ¶æ€ï¼š<span class="status-indicator status-ok">å‡†å¤‡å°±ç»ª</span></p>
    </div>
    
    <!-- æ¨¡æ‹Ÿä¸»é¡µ -->
    <div id="homePage" class="page active">
        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
            <h1>ğŸ“š æ•°å­¦ç»ƒä¹ ä¸»é¡µ</h1>
            <p>è¿™æ˜¯æ¨¡æ‹Ÿçš„ä¸»é¡µé¢</p>
            <div style="margin: 30px 0;">
                <button onclick="testChallenge()" style="padding: 15px 30px; font-size: 18px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; cursor: pointer;">
                    â±ï¸ ä¸€åˆ†é’ŸæŒ‘æˆ˜
                </button>
            </div>
            <p style="color: #666;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</p>
        </div>
    </div>
    
    <!-- æŒ‘æˆ˜é¡µé¢å®¹å™¨ -->
    <div id="challengePage" class="page" style="display: none;"></div>
    
    <!-- å…¶ä»–æµ‹è¯•é¡µé¢ -->
    <div id="categoryPage" class="page" style="display: none;">
        <div style="background: white; padding: 20px; border-radius: 10px;">
            <h2>ç±»åˆ«é€‰æ‹©é¡µé¢ï¼ˆæµ‹è¯•ç”¨ï¼‰</h2>
        </div>
    </div>
    
    <div id="practicePage" class="page" style="display: none;">
        <div style="background: white; padding: 20px; border-radius: 10px;">
            <h2>ç»ƒä¹ é¡µé¢ï¼ˆæµ‹è¯•ç”¨ï¼‰</h2>
        </div>
    </div>
    
    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <div class="debug-info" id="debugInfo">
        <div>è°ƒè¯•ä¿¡æ¯ï¼š</div>
    </div>
    
    <!-- å¼•å…¥JSæ–‡ä»¶ -->
    <script src="js/app.js"></script>
    <script src="js/features.js"></script>
    
    <script>
        // åˆå§‹åŒ–appå®ä¾‹
        const app = new MathPracticeApp();
        
        // åˆå§‹åŒ–featureç®¡ç†å™¨
        const featureManager = new FeatureManager();
        
        // æ—¥å¿—å‡½æ•°
        function log(msg) {
            const debugDiv = document.getElementById('debugInfo');
            const time = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<div>[${time}] ${msg}</div>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }
        
        // æµ‹è¯•æŒ‘æˆ˜æ¨¡å¼
        function testChallenge() {
            log('å¯åŠ¨ä¸€åˆ†é’ŸæŒ‘æˆ˜æ¨¡å¼...');
            updateStatus('æ­£åœ¨æŒ‘æˆ˜ä¸­', 'status-ok');
            
            try {
                startTimeChallenge(60);
                log('âœ… æŒ‘æˆ˜æ¨¡å¼å¯åŠ¨æˆåŠŸ');
                
                // ç›‘å¬é¡µé¢å˜åŒ–
                setTimeout(() => {
                    checkPageStatus();
                }, 100);
            } catch (error) {
                log('âŒ é”™è¯¯ï¼š' + error.message);
                updateStatus('å¯åŠ¨å¤±è´¥', 'status-error');
            }
        }
        
        // é‡å†™goHomeå‡½æ•°ï¼Œæ·»åŠ æ—¥å¿—
        const originalGoHome = window.goHome;
        window.goHome = function() {
            log('è°ƒç”¨ goHome() å‡½æ•°...');
            updateStatus('æ­£åœ¨è¿”å›é¦–é¡µ...', 'status-ok');
            
            // è°ƒç”¨åŸå§‹å‡½æ•°
            if (originalGoHome) {
                originalGoHome();
            }
            
            // æ£€æŸ¥ç»“æœ
            setTimeout(() => {
                const homePage = document.getElementById('homePage');
                const challengePage = document.getElementById('challengePage');
                
                const homeVisible = homePage && (homePage.style.display !== 'none') && homePage.classList.contains('active');
                const challengeHidden = challengePage && (challengePage.style.display === 'none');
                
                log(`é¦–é¡µå¯è§: ${homeVisible}`);
                log(`æŒ‘æˆ˜é¡µéšè—: ${challengeHidden}`);
                
                if (homeVisible && challengeHidden) {
                    log('âœ… æˆåŠŸè¿”å›é¦–é¡µï¼');
                    updateStatus('å·²è¿”å›é¦–é¡µ', 'status-ok');
                } else {
                    log('âŒ è¿”å›é¦–é¡µå¤±è´¥');
                    updateStatus('è¿”å›å¤±è´¥', 'status-error');
                    
                    // æ˜¾ç¤ºè¯¦ç»†çŠ¶æ€
                    log(`homePage.display: ${homePage ? homePage.style.display : 'null'}`);
                    log(`homePage.active: ${homePage ? homePage.classList.contains('active') : 'null'}`);
                    log(`challengePage.display: ${challengePage ? challengePage.style.display : 'null'}`);
                }
            }, 100);
        };
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(text, className) {
            const statusSpan = document.querySelector('#status .status-indicator');
            statusSpan.textContent = text;
            statusSpan.className = 'status-indicator ' + className;
        }
        
        // æ£€æŸ¥é¡µé¢çŠ¶æ€
        function checkPageStatus() {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                const visible = page.style.display !== 'none';
                const active = page.classList.contains('active');
                if (visible || active) {
                    log(`é¡µé¢ ${page.id}: display=${page.style.display || 'default'}, active=${active}`);
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        log('ç‚¹å‡»ã€ä¸€åˆ†é’ŸæŒ‘æˆ˜ã€‘æŒ‰é’®å¼€å§‹æµ‹è¯•');
        
        // åˆå§‹æ£€æŸ¥
        checkPageStatus();
    </script>
</body>
</html>
